import { describe, expect, it } from 'vitest'
import { isSlowMarket } from './isSlowMarket'

describe('isSlowMarket', () => {
  describe('應該在淡市時段返回 true', () => {
    it.each([
      ['台北時間凌晨0點', '2024-08-30T16:00:00.000Z'],
      ['台北時間凌晨1點', '2024-08-30T17:00:00.000Z'],
      ['台北時間凌晨3點', '2024-08-30T19:00:00.000Z'],
      ['台北時間凌晨4點', '2024-08-30T20:00:00.000Z'],
      ['台北時間凌晨5點', '2024-08-30T21:00:00.000Z'],
      ['台北時間凌晨6點', '2024-08-30T22:00:00.000Z'],
      ['台北時間凌晨7點', '2024-08-30T23:00:00.000Z'],
      ['台北時間上午10點', '2024-08-31T02:00:00.000Z'],
      ['台北時間中午12點', '2024-08-31T04:00:00.000Z'],
      ['台北時間下午1點', '2024-08-31T05:00:00.000Z'],
      ['台北時間下午4點', '2024-08-31T08:00:00.000Z'],
      ['台北時間下午6點', '2024-08-31T10:00:00.000Z'],
    ])('應該在 %s (%s) 返回 true', (description, isodate) => {
      expect(isSlowMarket(isodate)).toBe(true)
    })
  })

  describe('應該在活躍市場時段返回 false', () => {
    it.each([
      ['台北時間凌晨2點', '2024-08-30T18:00:00.000Z'],
      ['台北時間上午8點', '2024-08-31T00:00:00.000Z'],
      ['台北時間上午9點', '2024-08-31T01:00:00.000Z'],
      ['台北時間上午11點', '2024-08-31T03:00:00.000Z'],
      ['台北時間下午2點', '2024-08-31T06:00:00.000Z'],
      ['台北時間下午3點', '2024-08-31T07:00:00.000Z'],
      ['台北時間下午5點', '2024-08-31T09:00:00.000Z'],
      ['台北時間下午7點', '2024-08-31T11:00:00.000Z'],
      ['台北時間晚上8點', '2024-08-31T12:00:00.000Z'],
      ['台北時間晚上9點', '2024-08-31T13:00:00.000Z'],
      ['台北時間晚上10點', '2024-08-31T14:00:00.000Z'],
      ['台北時間晚上11點', '2024-08-31T15:00:00.000Z'],
    ])('應該在 %s (%s) 返回 false', (description, isodate) => {
      expect(isSlowMarket(isodate)).toBe(false)
    })
  })

  describe('邊界測試', () => {
    it.each([
      ['台北時間1點59分（淡市時段）', '2024-08-30T17:59:00.000Z', true],
      ['台北時間2點01分（活躍時段）', '2024-08-30T18:01:00.000Z', false],
      ['台北時間7點59分（淡市最後一分鐘）', '2024-08-30T23:59:00.000Z', true],
      ['台北時間8點01分（活躍時段開始）', '2024-08-31T00:01:00.000Z', false],
      ['台北時間9點59分（活躍時段）', '2024-08-31T01:59:00.000Z', false],
      ['台北時間10點01分（淡市時段）', '2024-08-31T02:01:00.000Z', true],
    ])('應該在 %s (%s) 返回 %s', (description, isodate, expected) => {
      expect(isSlowMarket(isodate)).toBe(expected)
    })
  })

  describe('跨日期與格式測試', () => {
    it.each([
      ['跨日期的淡市時段（凌晨3點）', '2024-08-31T19:00:00.000Z', true],
      ['不同月份的淡市時間（凌晨5點）', '2024-07-14T21:30:00.000Z', true],
      ['完整 ISO 時間字串（下午1點）', '2024-08-31T05:30:45.123Z', true],
      ['不含毫秒的 ISO 時間字串（下午1點）', '2024-08-31T05:30:45Z', true],
      ['本地時間格式（下午1點）', '2024-08-31T13:30:00+08:00', true],
      ['活躍時段的跨日期測試', '2024-09-01T01:30:00.000Z', false],
    ])('應該正確處理 %s (%s) 返回 %s', (description, isodate, expected) => {
      expect(isSlowMarket(isodate)).toBe(expected)
    })
  })
})
